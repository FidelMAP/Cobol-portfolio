       IDENTIFICATION DIVISION.
       PROGRAM-ID. LOAN_QUERY_BATCH.
       AUTHOR. YOUR-NAME.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT LOAN-FILE ASSIGN TO 'LOANS.DAT'
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS LOAN-ID
               FILE STATUS IS WS-FS-LOAN.
           SELECT QUERY-FILE ASSIGN TO 'LOAN_QUERY_INPUT.DAT'
               ORGANIZATION IS LINE SEQUENTIAL
               FILE STATUS IS WS-FS-QUERY.
           SELECT QUERY-RESULT-FILE ASSIGN TO 'LOAN_QUERY_OUTPUT.DAT'
               ORGANIZATION IS LINE SEQUENTIAL
               FILE STATUS IS WS-FS-RESULT.

       DATA DIVISION.
       FILE SECTION.
       
       FD LOAN-FILE.
       01 LOAN-RECORD.
           05 LOAN-ID        PIC 9(6).
           05 CLIENT-ID      PIC 9(6).
           05 AMOUNT         PIC 9(9)V99.
           05 INTEREST       PIC 9(3)V99.
           05 TERM-MONTHS    PIC 9(3).
           05 STATUSS        PIC X(10).
           05 PAID-MONTHS    PIC 9(3).
          
       01 RESULT-RECORD REDEFINES LOAN-RECORD.

       FD QUERY-RESULT-FILE. 
       01 RESULT-RECORD.
           05 RLOAN-ID        PIC 9(6).
           05 RCLIENT-ID      PIC 9(6).
           05 RAMOUNT         PIC 9(9)V99.
           05 RINTEREST       PIC 9(3)V99.
           05 RTERM-MONTHS    PIC 9(3).
           05 RSTATUSS        PIC X(10).
           05 RPAID-MONTHS    PIC 9(3).

       FD QUERY-FILE.
       01 QUERY-RECORD.
           05 QUERY-LOAN-ID  PIC 9(6).

       WORKING-STORAGE SECTION.
       01 WS-FS-LOAN        PIC XX.
       01 WS-FS-QUERY       PIC XX.
       01 WS-FS-RESULT      PIC XX.
       01 WS-EOF-QUERY      PIC X VALUE 'N'.
           88 EOF-QUERY VALUE 'Y'.
           88 NOT-EOF-QUERY VALUE 'N'.
       01 WS-EOF-RESULT     PIC X VALUE 'N'.
           88 EOF-RESULT VALUE 'Y'.
           88 NOT-EOF-RESULT VALUE 'N'.

       PROCEDURE DIVISION.
           OPEN I-O LOAN-FILE
           OPEN INPUT QUERY-FILE
           OPEN OUTPUT QUERY-RESULT-FILE

           SET NOT-EOF-QUERY TO TRUE

           *> Procesar cada Loan ID del fichero de entrada
           PERFORM UNTIL EOF-QUERY
               READ QUERY-FILE
                   AT END SET EOF-QUERY TO TRUE
                   NOT AT END
                       READ LOAN-FILE KEY IS QUERY-LOAN-ID
                           INVALID KEY
                               CONTINUE
                           NOT INVALID KEY
                               WRITE QUERY-RESULT-FILE
                       END-READ
               END-READ
           END-PERFORM

           CLOSE QUERY-FILE
           CLOSE LOAN-FILE
           CLOSE QUERY-RESULT-FILE

           *> Mostrar solo los resultados finales
           OPEN INPUT QUERY-RESULT-FILE
           SET NOT-EOF-RESULT TO TRUE
           PERFORM UNTIL EOF-RESULT
               READ QUERY-RESULT-FILE
                   AT END SET EOF-RESULT TO TRUE
                   NOT AT END
                       DISPLAY 'ID: ' LOAN-ID
                       DISPLAY 'Client: ' CLIENT-ID
                       DISPLAY 'Amount: ' AMOUNT
                       DISPLAY 'Interest: ' INTEREST
                       DISPLAY 'Term: ' TERM-MONTHS
                       DISPLAY 'Paid Months: ' PAID-MONTHS
                       DISPLAY 'Status: ' STATUSS
                       DISPLAY '---------------------------'
               END-READ
           END-PERFORM
           CLOSE QUERY-RESULT-FILE

           DISPLAY 'Loan query completed.'
           STOP RUN.
