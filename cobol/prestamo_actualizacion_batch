       IDENTIFICATION DIVISION.
       PROGRAM-ID. LOAN_UPDATE_BATCH.
       AUTHOR. YOUR-NAME.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT LOAN-FILE ASSIGN TO 'LOANS.IDX'
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS LOAN-ID
               FILE STATUS IS WS-LOAN-FS.
           SELECT UPDATE-FILE ASSIGN TO 'UPDATE_DATA.DAT'
               ORGANIZATION IS LINE SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-UPD-FS.

       DATA DIVISION.
       FILE SECTION.
       FD LOAN-FILE.
       01 LOAN-RECORD.
           05 LOAN-ID        PIC 9(6).
           05 CLIENT-ID      PIC 9(6).
           05 AMOUNT         PIC 9(9)V99.
           05 INTEREST       PIC 9(3)V99.
           05 TERM-MONTHS    PIC 9(3).
           05 STATUSS        PIC X(10).
           05 PAID-MONTHS    PIC 9(3).

       FD UPDATE-FILE.
       01 UPDATE-RECORD.
           05 UPD-LOAN-ID     PIC 9(6).
           05 UPD-PAYMENTS    PIC 9(3).

       WORKING-STORAGE SECTION.
       01 WS-EOF-UPDATE     PIC X VALUE 'N'.
           88 EOF-UPDATE VALUE 'Y'.
           88 NOT-EOF-UPDATE VALUE 'N'.
       01 WS-LOAN-FS        PIC XX.
       01 WS-UPD-FS         PIC XX.

       PROCEDURE DIVISION.
           OPEN I-O LOAN-FILE
           OPEN INPUT UPDATE-FILE

           PERFORM UNTIL EOF-UPDATE
               READ UPDATE-FILE
                   AT END SET EOF-UPDATE TO TRUE
                   NOT AT END
                       PERFORM PROCESS-UPDATE
               END-READ
           END-PERFORM

           CLOSE LOAN-FILE
           CLOSE UPDATE-FILE
           DISPLAY 'Batch indexed loan update completed.'
           STOP RUN.

       PROCESS-UPDATE.
           READ LOAN-FILE KEY IS UPD-LOAN-ID
               INVALID KEY
                   DISPLAY 'Loan ' UPD-LOAN-ID ' not found.'
               NOT INVALID KEY
                   ADD UPD-PAYMENTS TO PAID-MONTHS
                   IF PAID-MONTHS >= TERM-MONTHS
                       MOVE 'CLOSED' TO STATUSS
                   END-IF
                   REWRITE LOAN-RECORD
                   DISPLAY 'Loan ' LOAN-ID ' updated successfully.'
           END-READ.
