IDENTIFICATION DIVISION.
PROGRAM-ID. LOAN_CREATION_BATCH.
ENVIRONMENT DIVISION.
DATA DIVISION.
WORKING-STORAGE SECTION.
EXEC SQL
   INCLUDE SQLCA
END-EXEC.

01 WS-LOAN-ID    PIC 9(6).
01 WS-CLIENT-ID  PIC 9(6).
01 WS-AMOUNT     PIC 9(9)V99.
01 WS-INTEREST   PIC 9(3)V99.
01 WS-TERM       PIC 9(3).

PROCEDURE DIVISION.
    * Leer datos desde fichero o entrada batch
    OPEN INPUT LOAN-FILE
    READ LOAN-FILE INTO WS-LOAN-ID, WS-CLIENT-ID, WS-AMOUNT, WS-INTEREST, WS-TERM
        AT END
            DISPLAY 'Fin de datos de entrada'
    END-READ.

    EXEC SQL
       INSERT INTO LOANS_TABLE
           (LOAN_ID, CLIENT_ID, AMOUNT, INTEREST, TERM, STATUS)
       VALUES
           (:WS-LOAN-ID, :WS-CLIENT-ID, :WS-AMOUNT, :WS-INTEREST, :WS-TERM, 'OPEN')
    END-EXEC.

    IF SQLCODE = 0
       DISPLAY 'Préstamo creado: ' WS-LOAN-ID
    ELSE
       DISPLAY 'Error creación: ' SQLCODE
    END-IF.

    EXEC SQL COMMIT END-EXEC.
    CLOSE LOAN-FILE.
    STOP RUN.
