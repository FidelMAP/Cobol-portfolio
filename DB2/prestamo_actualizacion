IDENTIFICATION DIVISION.
PROGRAM-ID. LOAN_UPDATE_BATCH.
ENVIRONMENT DIVISION.
DATA DIVISION.
WORKING-STORAGE SECTION.
EXEC SQL
   INCLUDE SQLCA
END-EXEC.

01 WS-LOAN-ID    PIC 9(6).
01 WS-NEW-AMOUNT PIC 9(9)V99.
01 WS-NEW-STATUS PIC X(10).

PROCEDURE DIVISION.
    * Leer datos de actualización desde fichero batch
    OPEN INPUT UPDATE-FILE
    READ UPDATE-FILE INTO WS-LOAN-ID, WS-NEW-AMOUNT, WS-NEW-STATUS
        AT END
            DISPLAY 'Fin de datos de actualización'
    END-READ.

    EXEC SQL
       UPDATE LOANS_TABLE
          SET AMOUNT = :WS-NEW-AMOUNT,
              STATUS = :WS-NEW-STATUS
        WHERE LOAN_ID = :WS-LOAN-ID
    END-EXEC.

    IF SQLCODE = 0
       DISPLAY 'Préstamo actualizado: ' WS-LOAN-ID
    ELSE
       DISPLAY 'Error actualización: ' SQLCODE
    END-IF.

    EXEC SQL COMMIT END-EXEC.
    CLOSE UPDATE-FILE.
    STOP RUN.
